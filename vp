-- üì¶ Coquette Hub ‚Äî Vers√£o Final com WindUI, sem Whitelist

local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local StarterGui = game:GetService("StarterGui")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Debris = game:GetService("Debris")

local LocalPlayer = Players.LocalPlayer

-- üß© Vari√°veis de Estado
local COQUETTE_USERS = {
    ["Roun95"] = true,
    ["Deluxe_Studios"] = true,
    ["robloxian_uv30thinq"] = true,
}
local tagsVisiveis = true
local JAILED_PLAYERS = {}
local FROZEN_PLAYERS = {}

-- Configura√ß√£o de Jumpscares
local JUMPSCARES = {
    { Name = ";jumps1", ImageId = "rbxassetid://126754882337711", AudioId = "rbxassetid://138873214826309" },
    { Name = ";jumps2", ImageId = "rbxassetid://86379969987314", AudioId = "rbxassetid://143942090" },
    { Name = ";jumps3", ImageId = "rbxassetid://127382022168206", AudioId = "rbxassetid://143942090" },
    { Name = ";jumps4", ImageId = "rbxassetid://95973611964555", AudioId = "rbxassetid://138873214826309" },
}

-- Fun√ß√µes de A√ß√£o
local function FreezePlayer(player)
    if not player or not player.Character then return false end
    local h = player.Character:FindFirstChildOfClass("Humanoid")
    if not h or FROZEN_PLAYERS[player.Name] then return false end
    FROZEN_PLAYERS[player.Name] = { WalkSpeed = h.WalkSpeed, JumpPower = h.JumpPower }
    h.WalkSpeed = 0
    h.JumpPower = 0
    return true
end

local function UnfreezePlayer(player)
    if not player or not FROZEN_PLAYERS[player.Name] then return false end
    local s = FROZEN_PLAYERS[player.Name]
    if player.Character then
        local h = player.Character:FindFirstChildOfClass("Humanoid")
        if h then
            h.WalkSpeed = s.WalkSpeed
            h.JumpPower = s.JumpPower
        end
    end
    FROZEN_PLAYERS[player.Name] = nil
    return true
end

local function CreateAndManageJail(player)
    if not player or not player.Character then return false end
    local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if not rootPart or not humanoid then
        StarterGui:SetCore("SendNotification", {
            Title = "Jail Error",
            Text = "Jogador " .. player.Name .. " n√£o encontrado ou sem personagem!",
            Duration = 3
        })
        return false
    end

    -- Destroy existing cage
    local cageName = player.Name .. "_Cage"
    local existingCage = Workspace:FindFirstChild(cageName)
    if existingCage then existingCage:Destroy() end
    if JAILED_PLAYERS[player.Name] and JAILED_PLAYERS[player.Name].loop then
        task.cancel(JAILED_PLAYERS[player.Name].loop)
    end

    local cage = Instance.new("Model")
    cage.Name = cageName
    cage.Parent = Workspace

    local rootPos = rootPart.Position
    local size = Vector3.new(8, 8, 8)

    -- Helper function to create cage parts
    local function createPart(offset, sizePart, color)
        local part = Instance.new("Part")
        part.Size = sizePart
        part.Anchored = true
        part.CanCollide = true
        part.Material = Enum.Material.Neon
        part.BrickColor = BrickColor.new(color)
        part.Transparency = 0.3
        part.CFrame = CFrame.new(rootPos + offset)
        part.Parent = cage

        local surfaceLight = Instance.new("SurfaceLight")
        surfaceLight.Face = Enum.NormalId.Top
        surfaceLight.Range = 10
        surfaceLight.Brightness = 2
        surfaceLight.Color = Color3.fromRGB(75, 0, 130)
        surfaceLight.Parent = part
    end

    -- Create cage walls
    createPart(Vector3.new(0, size.Y / 2, 0), Vector3.new(size.X, 1, size.Z), "Royal purple")
    createPart(Vector3.new(0, -size.Y / 2, 0), Vector3.new(size.X, 1, size.Z), "Royal purple")
    createPart(Vector3.new(size.X / 2, 0, 0), Vector3.new(1, size.Y, size.Z), "Royal purple")
    createPart(Vector3.new(-size.X / 2, 0, 0), Vector3.new(1, size.Y, size.Z), "Royal purple")
    createPart(Vector3.new(0, 0, size.Z / 2), Vector3.new(size.X, size.Y, 1), "Royal purple")
    createPart(Vector3.new(0, 0, -size.Z / 2), Vector3.new(size.X, size.Y, 1), "Royal purple")

    -- Particle effects
    local particlePart = Instance.new("Part")
    particlePart.Size = Vector3.new(1, 1, 1)
    particlePart.Transparency = 1
    particlePart.Anchored = true
    particlePart.CanCollide = false
    particlePart.CFrame = CFrame.new(rootPos)
    particlePart.Parent = cage

    local particleEmitter = Instance.new("ParticleEmitter")
    particleEmitter.Texture = "rbxassetid://284205403"
    particleEmitter.Color = ColorSequence.new(Color3.fromRGB(75, 0, 130), Color3.fromRGB(138, 43, 226))
    particleEmitter.Size = NumberSequence.new(0.5, 1)
    particleEmitter.Rate = 25
    particleEmitter.Lifetime = NumberRange.new(1, 2)
    particleEmitter.Speed = NumberRange.new(1, 2)
    particleEmitter.Parent = particlePart

    -- Anti-noclip/fly loop
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not cage.Parent or not rootPart or not humanoid or not player.Parent then
            connection:Disconnect()
            if cage.Parent then cage:Destroy() end
            JAILED_PLAYERS[player.Name] = nil
            return
        end
        local cagePos = cage:GetBoundingBox().Position
        local dist = (rootPart.Position - cagePos).Magnitude
        if dist > size.X / 2 or humanoid.WalkSpeed > 16 or humanoid.PlatformStand then
            rootPart.CFrame = CFrame.new(cagePos)
        end
    end)

    JAILED_PLAYERS[player.Name] = { loop = connection }
    StarterGui:SetCore("SendNotification", {
        Title = "Jail",
        Text = "Jogador " .. player.Name .. " preso!",
        Duration = 3
    })
    return true
end

local function RemoveJail(player)
    local cage = Workspace:FindFirstChild(player.Name .. "_Cage")
    if cage then
        cage:Destroy()
        if JAILED_PLAYERS[player.Name] and JAILED_PLAYERS[player.Name].loop then
            task.cancel(JAILED_PLAYERS[player.Name].loop)
        end
        JAILED_PLAYERS[player.Name] = nil
        StarterGui:SetCore("SendNotification", {
            Title = "Unjail",
            Text = "Jaula removida de " .. player.Name,
            Duration = 3
        })
        return true
    else
        StarterGui:SetCore("SendNotification", {
            Title = "Unjail Error",
            Text = "Nenhuma jaula encontrada para " .. player.Name,
            Duration = 3
        })
        return false
    end
end

local function FloatPlayer(player)
    if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") or not player.Character:FindFirstChildOfClass("Humanoid") then return false end
    local targetHrp = player.Character.HumanoidRootPart
    local targetHumanoid = player.Character:FindFirstChildOfClass("Humanoid")
    local targetPos = targetHrp.Position

    targetHumanoid.WalkSpeed = 0
    targetHumanoid.JumpPower = 0

    local bodyVelocity = Instance.new("BodyVelocity", targetHrp)
    bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
    bodyVelocity.Velocity = Vector3.new(0, 10, 0)
    bodyVelocity.Name = "FloatVelocity"

    local maxHeight = targetPos.Y + 50
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not player.Character or not player.Character.Parent or not targetHrp.Parent or not targetHumanoid.Parent then
            bodyVelocity:Destroy()
            connection:Disconnect()
            return
        end
        if targetHrp.Position.Y >= maxHeight then
            bodyVelocity:Destroy()
            connection:Disconnect()
            targetHumanoid.Health = 0
        end
    end)
    return true
end

local function FlingPlayer(player)
    if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return false end
    local targetHrp = player.Character.HumanoidRootPart
    local targetCFrame = CFrame.new(99999, 999999, 99999)
    local tween = TweenService:Create(targetHrp, TweenInfo.new(2), { CFrame = targetCFrame })
    tween:Play()
    tween.Completed:Wait()
    StarterGui:SetCore("SendNotification", {
        Title = "Fling",
        Text = "Jogador " .. player.Name .. " lan√ßado!",
        Duration = 3
    })
    return true
end

local function KillPlus(player)
    if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return false end
    local targetHrp = player.Character.HumanoidRootPart
    local targetPos = targetHrp.Position
    player.Character:BreakJoints()

    local parts = {}
    for i = 1, 5 do
        local part = Instance.new("Part")
        part.Size = Vector3.new(6, 6, 6)
        part.Anchored = false
        part.CanCollide = false
        part.Material = Enum.Material.Neon
        part.BrickColor = BrickColor.Random()
        part.CFrame = targetHrp.CFrame
        part.Parent = Workspace
        local bv = Instance.new("BodyVelocity")
        bv.Velocity = Vector3.new(math.random(-80, 80), math.random(50, 100), math.random(-80, 80))
        bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
        bv.Parent = part
        Debris:AddItem(part, 3)
        table.insert(parts, part)
    end
    StarterGui:SetCore("SendNotification", {
        Title = "Kill Plus",
        Text = "Jogador " .. player.Name .. " morto com efeito!",
        Duration = 3
    })
    return true
end

local function TriggerJumpscare(player, jumpscare)
    if not player or player ~= LocalPlayer then return false end
    local screenGui = Instance.new("ScreenGui", CoreGui)
    screenGui.Name = "JumpscareGui"
    screenGui.IgnoreGuiInset = true
    local imageLabel = Instance.new("ImageLabel", screenGui)
    imageLabel.Size = UDim2.new(1, 0, 1, 0)
    imageLabel.Position = UDim2.new(0, 0, 0, 0)
    imageLabel.BackgroundTransparency = 1
    imageLabel.Image = jumpscare.ImageId
    local sound = Instance.new("Sound", screenGui)
    sound.SoundId = jumpscare.AudioId
    sound.Volume = 1
    sound.Looped = false
    sound:Play()
    local flashCount = 10
    local flashInterval = 0.2
    for i = 1, flashCount do
        if not screenGui.Parent then break end
        imageLabel.ImageTransparency = (i % 2 == 0) and 0.3 or 0
        task.wait(flashInterval)
    end
    sound:Stop()
    screenGui:Destroy()
    return true
end

-- Fun√ß√£o para enviar mensagens via TextChatService
local function sendChat(msg)
    local ok, channel = pcall(function() return TextChatService.TextChannels and TextChatService.TextChannels.RBXGeneral end)
    if ok and channel then
        pcall(function() channel:SendAsync(tostring(msg)) end)
        StarterGui:SetCore("SendNotification", {
            Title = "Comando",
            Text = "Comando enviado: " .. msg,
            Duration = 3
        })
    else
        StarterGui:SetCore("SendNotification", {
            Title = "Erro",
            Text = "Canal de chat RBXGeneral n√£o encontrado!",
            Duration = 3
        })
    end
end

-- Processamento de Comandos
local function ProcessCommand(player, message)
    local msgText = message:lower()
    local args = string.split(msgText, " ")
    local cmd = args[1]
    local targetName = args[2]
    local targetPlayer = targetName and Players:FindFirstChild(targetName)

    if cmd == ";verifique" then
        StarterGui:SetCore("SendNotification", {
            Title = "Verificar Hubs",
            Text = "Verifica√ß√£o conclu√≠da!",
            Duration = 3
        })
    elseif cmd == ";kick" and targetPlayer then
        targetPlayer:Kick("Banned from the game - Coquette Hub!")
    elseif cmd == ";kill" and targetPlayer then
        if targetPlayer.Character then
            targetPlayer.Character:BreakJoints()
            StarterGui:SetCore("SendNotification", {
                Title = "Kill",
                Text = "Jogador " .. targetPlayer.Name .. " morto!",
                Duration = 3
            })
        end
    elseif cmd == ";killplus" and targetPlayer then
        KillPlus(targetPlayer)
    elseif cmd == ";fling" and targetPlayer then
        FlingPlayer(targetPlayer)
    elseif cmd == ";bring" and targetPlayer then
        if targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            targetPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame * CFrame.new(2, 0, 0)
            StarterGui:SetCore("SendNotification", {
                Title = "Bring",
                Text = "Jogador " .. targetPlayer.Name .. " trazido!",
                Duration = 3
            })
        end
    elseif cmd == ";jail" and targetPlayer then
        CreateAndManageJail(targetPlayer)
    elseif cmd == ";unjail" and targetPlayer then
        RemoveJail(targetPlayer)
    elseif cmd == ";freeze" and targetPlayer then
        if FreezePlayer(targetPlayer) then
            StarterGui:SetCore("SendNotification", {
                Title = "Freeze",
                Text = "Jogador " .. targetPlayer.Name .. " congelado!",
                Duration = 3
            })
        end
    elseif cmd == ";unfreeze" and targetPlayer then
        if UnfreezePlayer(targetPlayer) then
            StarterGui:SetCore("SendNotification", {
                Title = "Unfreeze",
                Text = "Jogador " .. targetPlayer.Name .. " descongelado!",
                Duration = 3
            })
        end
    elseif cmd == ";tag" and targetPlayer then
        COQUETTE_USERS[targetPlayer.Name] = true
        StarterGui:SetCore("SendNotification", {
            Title = "Tag",
            Text = "Tag adicionada a " .. targetPlayer.Name,
            Duration = 3
        })
    elseif cmd == ";untag" and targetPlayer then
        COQUETTE_USERS[targetPlayer.Name] = nil
        StarterGui:SetCore("SendNotification", {
            Title = "Untag",
            Text = "Tag removida de " .. targetPlayer.Name,
            Duration = 3
        })
    elseif cmd == ";tag" and targetName == "all" then
        for _, p in ipairs(Players:GetPlayers()) do
            COQUETTE_USERS[p.Name] = true
        end
        StarterGui:SetCore("SendNotification", {
            Title = "Tag All",
            Text = "Tag adicionada a todos os jogadores!",
            Duration = 3
        })
    elseif cmd == ";untag" and targetName == "all" then
        COQUETTE_USERS = {}
        StarterGui:SetCore("SendNotification", {
            Title = "Untag All",
            Text = "Tag removida de todos os jogadores!",
            Duration = 3
        })
    elseif cmd == ";float" and targetPlayer then
        FloatPlayer(targetPlayer)
        StarterGui:SetCore("SendNotification", {
            Title = "Float",
            Text = "Jogador " .. targetPlayer.Name .. " flutuando!",
            Duration = 3
        })
    elseif table.find({ ";jumps1", ";jumps2", ";jumps3", ";jumps4" }, cmd) then
        for _, j in ipairs(JUMPSCARES) do
            if j.Name == cmd then
                TriggerJumpscare(player, j)
                StarterGui:SetCore("SendNotification", {
                    Title = "Jumpscare",
                    Text = "Jumpscare " .. cmd .. " ativado!",
                    Duration = 3
                })
                break
            end
        end
    end
end

-- Conectar TextChatService
local connections = {}
table.insert(connections, TextChatService.MessageReceived:Connect(function(message)
    if message.TextSource then
        local player = Players:FindFirstChild(message.TextSource.Name)
        if player then
            ProcessCommand(player, message.Text)
        end
    end
end))

-- Cleanup on Player Leaving
Players.PlayerRemoving:Connect(function(player)
    RemoveJail(player)
    UnfreezePlayer(player)
    COQUETTE_USERS[player.Name] = nil
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local bodyVelocity = player.Character.HumanoidRootPart:FindFirstChild("FloatVelocity")
        if bodyVelocity then bodyVelocity:Destroy() end
    end
    for i = 1, 5 do
        local part = Workspace:FindFirstChild("KillPlusPart_" .. player.Name .. "_" .. i)
        if part then part:Destroy() end
    end
end)

-- Configura√ß√£o da WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Window = WindUI:CreateWindow({
    Title = "Coquette Hub",
    Icon = "shield",
    Author = "by Dark",
    Size = UDim2.fromOffset(580, 460),
    Transparent = true,
    Theme = "Dark",
    Resizable = true
})

-- Dynamic Player List
local playerNames = {}
for _, player in ipairs(Players:GetPlayers()) do
    table.insert(playerNames, player.Name)
end
local SelectedPlayer = LocalPlayer.Name

-- Command Tab and Dropdown
local TabComandos = Window:Tab({ Title = "Comandos", Icon = "terminal" })
local Dropdown = TabComandos:Dropdown({
    Title = "Selecionar Jogador",
    Values = playerNames,
    Callback = function(value)
        SelectedPlayer = value
    end
})

-- Update player list on join/leave
table.insert(connections, Players.PlayerAdded:Connect(function(player)
    table.insert(playerNames, player.Name)
    Dropdown:SetValues(playerNames)
end))

table.insert(connections, Players.PlayerRemoving:Connect(function(player)
    for i, name in ipairs(playerNames) do
        if name == player.Name then
            table.remove(playerNames, i)
            break
        end
    end
    Dropdown:SetValues(playerNames)
    RemoveJail(player)
end))

-- Command Buttons
local buttons = {
    { "Verificar Hubs", ";verifique" },
    { "Kick", ";kick" },
    { "Kill", ";kill" },
    { "Kill Plus", ";killplus" },
    { "Fling", ";fling" },
    { "Bring", ";bring" },
    { "Jail", ";jail" },
    { "Unjail", ";unjail" },
    { "Freeze", ";freeze" },
    { "Unfreeze", ";unfreeze" },
    { "Tag", ";tag" },
    { "Untag", ";untag" },
    { "Tag All", ";tag all" },
    { "Untag All", ";untag all" },
    { "Float", ";float" },
    { "Jumpscare 1", ";jumps1" },
    { "Jumpscare 2", ";jumps2" },
    { "Jumpscare 3", ";jumps3" },
    { "Jumpscare 4", ";jumps4" }
}

for _, button in ipairs(buttons) do
    local title, cmd = button[1], button[2]
    TabComandos:Button({
        Title = title,
        Callback = function()
            if cmd == ";jail" then
                CreateAndManageJail(Players:FindFirstChild(SelectedPlayer))
            elseif cmd == ";unjail" then
                RemoveJail(Players:FindFirstChild(SelectedPlayer))
            else
                sendChat(cmd .. (string.find(cmd, "^;[%w]+%s+all$") or not string.find(cmd, "^;jumps") and " " .. SelectedPlayer or ""))
            end
        end
    })
end

-- Inicializar UI para todos os jogadores
StarterGui:SetCore("SendNotification", {
    Title = "Coquette Hub",
    Text = "Painel WindUI Midnight carregado!",
    Duration = 4
})

-- Cleanup on script termination
game:BindToClose(function()
    for _, connection in ipairs(connections) do
        connection:Disconnect()
    end
    for _, player in ipairs(Players:GetPlayers()) do
        RemoveJail(player)
        UnfreezePlayer(player)
    end
end)
